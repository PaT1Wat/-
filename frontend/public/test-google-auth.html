<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sign-In Test (Client-Only)</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .info-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .user-info {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .user-info.show {
            display: block;
        }
        .user-info img {
            border-radius: 50%;
            width: 64px;
            height: 64px;
            margin-right: 15px;
            vertical-align: middle;
        }
        button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #c82333;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Google Sign-In Test</h1>
        <p class="subtitle">Client-Only Authentication Demo</p>
        
        <div class="info-box">
            <strong>‚ö†Ô∏è Setup Required:</strong><br>
            Before testing, replace <code>YOUR_GOOGLE_CLIENT_ID</code> in the script below with your actual Google OAuth Client ID from Google Cloud Console.
        </div>

        <div id="buttonDiv"></div>

        <div id="userInfo" class="user-info">
            <h3>‚úÖ Signed In Successfully!</h3>
            <div id="userDetails"></div>
            <button onclick="signOut()">Sign Out</button>
        </div>
    </div>

    <script>
        // REPLACE THIS with your actual Google Client ID
        const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID';

        function handleCredentialResponse(response) {
            // Decode JWT token (basic decode - for demo only!)
            const payload = parseJwt(response.credential);
            
            console.log('Google Sign-In Successful:', payload);
            
            // Store user info
            const user = {
                id: payload.sub,
                email: payload.email,
                name: payload.name,
                picture: payload.picture,
                email_verified: payload.email_verified
            };
            
            localStorage.setItem('google_user', JSON.stringify(user));
            localStorage.setItem('google_token', response.credential);
            
            // Display user info
            displayUserInfo(user);
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function displayUserInfo(user) {
            const userInfo = document.getElementById('userInfo');
            const userDetails = document.getElementById('userDetails');
            
            // Clear previous content
            userDetails.innerHTML = '';
            
            // Create elements safely to prevent XSS
            const img = document.createElement('img');
            img.src = user.picture;
            img.alt = user.name;
            
            const div = document.createElement('div');
            div.style.display = 'inline-block';
            div.style.verticalAlign = 'middle';
            
            const nameStrong = document.createElement('strong');
            nameStrong.textContent = user.name;
            
            const emailText = document.createTextNode(user.email);
            const verifiedSmall = document.createElement('small');
            verifiedSmall.textContent = `Email verified: ${user.email_verified ? '‚úì' : '‚úó'}`;
            
            div.appendChild(nameStrong);
            div.appendChild(document.createElement('br'));
            div.appendChild(emailText);
            div.appendChild(document.createElement('br'));
            div.appendChild(verifiedSmall);
            
            userDetails.appendChild(img);
            userDetails.appendChild(div);
            
            userInfo.classList.add('show');
            document.getElementById('buttonDiv').style.display = 'none';
        }

        function signOut() {
            localStorage.removeItem('google_user');
            localStorage.removeItem('google_token');
            
            if (window.google?.accounts?.id) {
                google.accounts.id.disableAutoSelect();
            }
            
            document.getElementById('userInfo').classList.remove('show');
            document.getElementById('buttonDiv').style.display = 'block';
            
            // Re-initialize Google Sign-In
            initGoogleSignIn();
        }

        function initGoogleSignIn() {
            if (GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID') {
                document.getElementById('buttonDiv').innerHTML = 
                    '<div style="background: #ffebee; color: #d32f2f; padding: 15px; border-radius: 8px;">' +
                    '<strong>‚ö†Ô∏è Configuration Error</strong><br>' +
                    'Please replace YOUR_GOOGLE_CLIENT_ID with your actual Client ID in the HTML file.' +
                    '</div>';
                return;
            }

            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse
            });

            google.accounts.id.renderButton(
                document.getElementById('buttonDiv'),
                { 
                    theme: 'outline', 
                    size: 'large',
                    text: 'signin_with',
                    width: 300
                }
            );

            // Check if user is already signed in
            const storedUser = localStorage.getItem('google_user');
            if (storedUser) {
                displayUserInfo(JSON.parse(storedUser));
            }
        }

        // Initialize when Google script loads
        window.onload = function() {
            initGoogleSignIn();
        };
    </script>
</body>
</html>
